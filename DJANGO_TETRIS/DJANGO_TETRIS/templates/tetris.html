<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script>
class Block{
	constructor(){
		this.type = 2;
		this.status = 0;
		this.i = 2;
		this.j = 3;
	}
}
var flagOver = false;
var b = new Block();

var block2D = [
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0]
];

var stack2D = [
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0]
];

var displ2D = [
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0],
	[0,0,0,0,0, 0,0,0,0,0]
];

function setBlock2D(){
	
	for(i = 0; i < 25; i++){
		for(j = 0; j < 10; j++){
			block2D[i][j] = 0
		}
	}
	
	if(b.type==1){
		block2D[b.i]	[b.j] 	= b.type;
		block2D[b.i]	[b.j+1] = b.type;
		block2D[b.i+1]	[b.j] 	= b.type;
		block2D[b.i+1]	[b.j+1] = b.type;
	}
	if(b.type==2){
		if(b.status ==0){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i-1]	[b.j] = b.type;
			block2D[b.i-2]	[b.j] 	= b.type;
			block2D[b.i+1]	[b.j] 	= b.type;
		}else if(b.status == 1){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i]	[b.j-1] = b.type;
			block2D[b.i]	[b.j-2] = b.type;
			block2D[b.i]	[b.j+1] = b.type;
		}
	}
	if(b.type==3){
		if(b.status ==0){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i]	[b.j+1] 	= b.type;
			block2D[b.i-1]	[b.j+1] 	= b.type;
			block2D[b.i+1]	[b.j] 	= b.type;
		}else if(b.status == 1){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i-1]	[b.j] 	= b.type;
			block2D[b.i-1]	[b.j-1] 	= b.type;
			block2D[b.i][b.j+1] 	= b.type;
		}
	}
	
	if(b.type==4){
		if(b.status ==0){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i-1]	[b.j] 	= b.type;
			block2D[b.i]	[b.j+1] 	= b.type;
			block2D[b.i+1]	[b.j+1] 	= b.type;
		}else if(b.status == 1){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i]	[b.j-1] 	= b.type;
			block2D[b.i-1]	[b.j] 	= b.type;
			block2D[b.i-1]	[b.j+1] 	= b.type;
		}
	}
	if(b.type==5){
		if(b.status ==0){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i]	[b.j-1] 	= b.type;
			block2D[b.i]	[b.j+1] 	= b.type;
			block2D[b.i-1]	[b.j+1] 	= b.type;
		}else if(b.status == 1){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i+1]	[b.j] 	= b.type;
			block2D[b.i-1]	[b.j] 	= b.type;
			block2D[b.i-1]	[b.j-1] 	= b.type;
		}else if(b.status == 2){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i]	[b.j-1] 	= b.type;
			block2D[b.i+1]	[b.j-1] 	= b.type;
			block2D[b.i]	[b.j+1] 	= b.type;
		}else if(b.status == 3){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i-1]	[b.j] 	= b.type;
			block2D[b.i+1]	[b.j] 	= b.type;
			block2D[b.i+1]	[b.j+1] 	= b.type;
		}
	}
	if(b.type==6){
		if(b.status ==0){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i]	[b.j+1] 	= b.type;
			block2D[b.i]	[b.j-1] 	= b.type;
			block2D[b.i-1]	[b.j-1] 	= b.type;
		}else if(b.status == 1){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i-1]	[b.j] 	= b.type;
			block2D[b.i+1]	[b.j] 	= b.type;
			block2D[b.i+1]	[b.j-1] 	= b.type;
		}else if(b.status == 2){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i]	[b.j-1] 	= b.type;
			block2D[b.i]	[b.j+1] 	= b.type;
			block2D[b.i+1]	[b.j+1] 	= b.type;
		}else if(b.status == 3){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i+1]	[b.j] 	= b.type;
			block2D[b.i-1]	[b.j] 	= b.type;
			block2D[b.i-1]	[b.j+1] 	= b.type;
		}
	}
	if(b.type==7){
		if(b.status ==0){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i-1]	[b.j] 	= b.type;
			block2D[b.i]	[b.j+1] 	= b.type;
			block2D[b.i]	[b.j-1] 	= b.type;
		}else if(b.status == 1){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i]	[b.j-1] 	= b.type;
			block2D[b.i-1]	[b.j] 	= b.type;
			block2D[b.i+1]	[b.j] 	= b.type;
		}else if(b.status == 2){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i+1]	[b.j] 	= b.type;
			block2D[b.i]	[b.j-1] 	= b.type;
			block2D[b.i]	[b.j+1] 	= b.type;
		}else if(b.status == 3){
			block2D[b.i]	[b.j] 	= b.type;
			block2D[b.i-1]	[b.j] 	= b.type;
			block2D[b.i+1]	[b.j] 	= b.type;
			block2D[b.i]	[b.j+1] 	= b.type;
		}
	}
}

function my_render(){
	var tiles = document.querySelectorAll('.tile');
	
	for(i = 0; i < 25; i++){
		for(j = 0; j < 10; j++){
			if(displ2D[i][j] == 0){
				tiles[i*10+j].style.backgroundColor = 'white';
			}
			if(displ2D[i][j] == 1){
				tiles[i*10+j].style.backgroundColor = 'red';
			}
			if(displ2D[i][j] == 2){
				tiles[i*10+j].style.backgroundColor = 'orange';
			}
			if(displ2D[i][j] == 3){
				tiles[i*10+j].style.backgroundColor = 'yellow';
			}
			if(block2D[i][j] == 4){
				tiles[i*10+j].style.backgroundColor = 'green';
			}
			if(displ2D[i][j] == 5){
				tiles[i*10+j].style.backgroundColor = 'blue';
			}
			if(displ2D[i][j] == 6){
				tiles[i*10+j].style.backgroundColor = 'indigo';
			}
			if(displ2D[i][j] == 7){
				tiles[i*10+j].style.backgroundColor = 'purple';
			}
			if(displ2D[i][j] == 11){
				tiles[i*10+j].style.backgroundColor = '#FF6464';
			}
			if(displ2D[i][j] == 12){
				tiles[i*10+j].style.backgroundColor = '#FFAA28';
			}
			if(displ2D[i][j] == 13){
				tiles[i*10+j].style.backgroundColor = '#FFFF96';
			}
			if(displ2D[i][j] == 14){
				tiles[i*10+j].style.backgroundColor = '#C6FF70';
			}
			if(displ2D[i][j] == 15){
				tiles[i*10+j].style.backgroundColor = '#6482FF';
			}
			if(displ2D[i][j] == 16){
				tiles[i*10+j].style.backgroundColor = '#3C5A91';
			}
			if(displ2D[i][j] == 17){
				tiles[i*10+j].style.backgroundColor = '#7878FF';
			}
		}
	}
}
function rotate(){
	if(b.type==1){
		
	}else if(b.type==2||b.type==3||b.type==4){
		if(b.status==0){
			b.status=1;
		}else if(b.status==1){
			b.status=0;
		}
	}else if(b.type==5||b.type==6||b.type==7){
		if(b.status==0){
			b.status=1;
		}else if(b.status==1){
			b.status=2;
		}else if(b.status==2){
			b.status=3;
		}else if(b.status==3){
			b.status=0;
		}
	}
}

function setDispl2D(){
	
	for(i = 0; i < 25; i++){
		for(j = 0; j < 10; j++){
			displ2D[i][j] = 0
		}
	}
	
	for(i = 0; i < 25; i++){
		for(j = 0; j < 10; j++){
			if(block2D[i][j] > 0){
				displ2D[i][j]=block2D[i][j]
			}
		}
	}
	for(i = 0; i < 25; i++){
		for(j = 0; j < 10; j++){
			if(stack2D[i][j] > 0){
				displ2D[i][j]=stack2D[i][j]
			}
		}
	}
	
	
}

function isBlockStack(){
	for(i = 0; i < 25; i++){
		for(j = 0; j < 10; j++){
			if(stack2D[i][j] > 0 && block2D[i][j] > 0){
				return true
			}
		}
	}
}

function isBlockSide(){
	var cnt = 0
	for(i = 0; i < 25; i++){
		for(j = 0; j < 10; j++){
			if(block2D[i][j] > 0){
				cnt += 1;
			}
		}
	}
	
	if(cnt == 4){
		return false
	}else{
		return true
	}
	
}

function moveBlock2DToStack2D(){
	for(i = 0; i < 25; i++){
		for(j = 0; j < 10; j++){
			if(block2D[i][j] > 0){
				stack2D[i][j] = parseInt(block2D[i][j]) + 10
			}
		}
	}
}

function getMax10(){
	var cnt = 0;
	for(i = 0; i < stack2D.length; i++){
		var line = stack2D[i]
		if(
			line[0]>0 && line[1]>0 && line[2]>0 && line[3]>0 &&	line[4]>0 && 
			line[5]>0 && line[6]>0 && line[7]>0 && line[8]>0 &&line[9]>0
		 ){
			cnt++;
		}
	}
	return cnt

}

function cleanStack(cnt_max){
	var s = [];
	for(var i=0; i<cnt_max; i++){
		s.push([0,0,0,0,0, 0,0,0,0,0]+"")
	}
	
	for(var i = 0; i < stack2D.length; i++){
		var line = stack2D[i]
		if(
			!(line[0]>0 && line[1]>0 && line[2]>0 && line[3]>0 && line[4]>0 && 
			line[5]>0 && line[6]>0 && line[7]>0 && line[8]>0 &&line[9]>0)
		 ){
			s.push(line+"");
		}
	}
	
	for(var i=0; i<25; i++){
		var arr_s = s[i].split(",");
		stack2D[i][0]=arr_s[0]
		stack2D[i][1]=arr_s[1]
		stack2D[i][2]=arr_s[2]
		stack2D[i][3]=arr_s[3]
		stack2D[i][4]=arr_s[4]

		stack2D[i][5]=arr_s[5]
		stack2D[i][6]=arr_s[6]
		stack2D[i][7]=arr_s[7]
		stack2D[i][8]=arr_s[8]
		stack2D[i][9]=arr_s[9]
	}

}

function myclick(e){
	if(flagOver){
		return
	}
	
	var back_status = b.status
	var back_i = b.i
	var back_j = b.j
	
	var flagDown = false;
	var code = e.code
	
	if(code == "Space"){
		rotate()
	}
	
	if(code =="ArrowUp"){ //위
		b.i--
	}
	if(code =="ArrowDown"){ //하
		b.i++;
		flagDown = true
	}
	if(code =="ArrowLeft"){//좌
		b.j--;
		
	}
	if(code =="ArrowRight"){//우
		b.j++;
	}
	var flagBlockErr = false;
	
	try{
		setBlock2D()
	}catch(error){
		flagBlockErr = true;
	}
	
	setDispl2D()
	
	var flagBlockStack = isBlockStack() 
	var flagBlockSide = isBlockSide() 
	var flagCrush = flagBlockErr||flagBlockStack||flagBlockSide
	
	
	if(flagCrush){
		b.status = back_status
		b.i = back_i
		b.j = back_j
		setBlock2D()
		setDispl2D()
	}
	
	if(flagCrush && flagDown){
		moveBlock2DToStack2D();
		
		var cnt_max = getMax10();
		var obj_remain = document.querySelector('#my_remained')
		var cnt_remain = parseInt(document.querySelector('#my_remained').innerText)
		cnt_remain -= cnt_max;
		obj_remain.innerText = cnt_remain
		if(cnt_remain<=0){
			flagOver = true
			alert("mission completed")
		}
		
		if(
			stack2D[4][0]>0||
			stack2D[4][1]>0||
			stack2D[4][2]>0||
			stack2D[4][3]>0||
			stack2D[4][4]>0||
			stack2D[4][5]>0||
			stack2D[4][6]>0||
			stack2D[4][7]>0||
			stack2D[4][8]>0||
			stack2D[4][9]>0
		){
			alert("gameover")
			flagOver = true;
		}
		
		console.log(cnt_max)
		cleanStack(cnt_max);
		b.type = parseInt(Math.random()*7) + 1
		b.i = 2
		b.j = 3
		
		setBlock2D()
		setDispl2D()
	}
	
	my_render()
}

function fn_init(){
	fn_tick();
}

var tick = 0;
function fn_tick(){
	myclick({'code' : 'ArrowDown'})
	console.log(tick)
	setTimeout(() => {
		fn_tick()
	}, 1000);
}

document.addEventListener('keydown', function(e){
	myclick(e)
})

</script>
<style>
.tile{
	width:20px;
	height:20px;
}
</style>


</head>
<body onload="fn_init()">
 TETRIS 남은블록 : <span id="my_remained">1</span>
<table border="1">
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
	<tr>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
		<td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td><td class="tile"></td>
	</tr>
</table>
</body>
</html>